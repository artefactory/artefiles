# 1Password SSH agent configuration for fish shell
# Only set up when not in an SSH session

if not set -q SSH_TTY; and not set -q SSH_CLIENT; and not set -q SSH_CONNECTION
{{- if eq .chezmoi.os "darwin" }}
  # Create the symlink to make it easier to reference
  if not test -e "$HOME/.1password"
    mkdir -p "$HOME/.1password"
  end
  
  if not test -L "$HOME/.1password/agent.sock"
    ln -sf "$HOME/Library/Group Containers/2BUA8C4S2C.com.1password/t/agent.sock" "$HOME/.1password/agent.sock"
  end
  
  # Set the env variable to the symlink for easier use
  set -gx SSH_AUTH_SOCK "$HOME/.1password/agent.sock"
{{- else }}
  # Linux and other OS use the direct path
  set -gx SSH_AUTH_SOCK "$HOME/.1password/agent.sock"
{{- end }}
end